<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Payment — GoGlobal</title>
<link rel="stylesheet" href="flights.css">
</head>
<body>
<header class="gg-header">
  <div class="container header-inner">
    <a class="logo" href="index.html">Go-Global Recruitment</a>
  </div>
</header>

<main class="container" style="padding-top:28px">
  <h2>Confirm & Pay</h2>
  <div id="summary"></div>

  <section style="margin-top:18px;background:#fff;padding:18px;border-radius:12px;border:1px solid #eef2f6">
    <p><strong>Payment options</strong></p>
    <p>This demo will generate a QR payment link. In production you connect a payment gateway (PayGate, PayU, Paystack)</p>
    <div style="margin-top:10px">
      <button id="generateQR" class="btn primary">Generate payment QR</button>
    </div>

    <div id="qrArea" style="margin-top:12px"></div>

    <div id="resultArea" style="margin-top:12px"></div>
  </section>
</main>

<script>
const booking = JSON.parse(sessionStorage.getItem('gg_booking') || 'null');
if(!booking){ alert('No booking in session'); location.href='flights.html'; }
document.getElementById('summary').innerHTML = `<strong>${booking.airline}</strong> ${booking.origin} → ${booking.dest} • Seats: ${booking.seats?.join(',') || '—'} • Price: ZAR ${Number(booking.price).toLocaleString()}`;

function generateReference(){
  const ref = 'GG-'+Math.random().toString(36).slice(2,9).toUpperCase();
  return ref;
}

document.getElementById('generateQR').addEventListener('click',()=>{
  const ref = generateReference();
  booking.ref = ref;
  sessionStorage.setItem('gg_booking', JSON.stringify(booking));
  const qrArea = document.getElementById('qrArea');
  qrArea.innerHTML = '';
  // Simple QR placeholder using Google Chart API
  const payLink = encodeURIComponent(`https://goglobal-pay.example/pay?ref=${ref}&amount=${booking.price}`);
  const qrImg = document.createElement('img');
  qrImg.src = `https://chart.googleapis.com/chart?cht=qr&chs=240x240&chl=${payLink}`;
  qrImg.alt = 'QR code';
  qrArea.appendChild(qrImg);

  const btns = document.createElement('div');
  btns.style.marginTop='10px';
  btns.innerHTML = '<button id="paidBtn" class="btn">Simulate Paid</button> <button id="failBtn" class="btn">Simulate Decline</button>';
  qrArea.appendChild(btns);

  document.getElementById('paidBtn').onclick = ()=> finalize(true);
  document.getElementById('failBtn').onclick = ()=> finalize(false);
});

function finalize(success){
  const area = document.getElementById('resultArea');
  if(success){
    // lock booking: create a "receipt" and clear sensitive form data if any
    const receipt = {
      ref: booking.ref,
      id: booking.id,
      status: 'Paid',
      paidAt: new Date().toISOString()
    };
    sessionStorage.setItem('gg_receipt', JSON.stringify(receipt));
    area.innerHTML = `<div style="padding:12px;border-radius:8px;background:#eef9f1;border:1px solid #dff2e6"><strong>Payment successful</strong><div>Booking ref: ${receipt.ref}</div></div>
    <div style="margin-top:10px"><a class="btn" href="confirmation.html">View confirmation</a></div>`;
    // disable generate button
    document.getElementById('generateQR').disabled = true;
  } else {
    area.innerHTML = `<div style="padding:12px;border-radius:8px;background:#fff6f6;border:1px solid #ffdede"><strong>Payment declined</strong><div>Please try again or contact support.</div></div>`;
  }
}
</script>
</body>
</html>
