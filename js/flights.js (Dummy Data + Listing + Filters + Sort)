// Dummy flight data for international + local
const flightData = [
  {id:"f1", from:"Cape Town", to:"Johannesburg", airline:"South African Airways", stops:0, departure:"08:00", arrival:"10:00", duration:"2h", price:193, logo:"https://content.airlinelogos.com/airlines/saa.png"},
  {id:"f2", from:"Cape Town", to:"Durban", airline:"Emirates", stops:1, departure:"09:00", arrival:"11:45", duration:"2h 45m", price:183, logo:"https://content.airlinelogos.com/airlines/emirates.png"},
  {id:"f3", from:"Cape Town", to:"London", airline:"British Airways", stops:1, departure:"22:00", arrival:"10:00+1", duration:"12h", price:423, logo:"https://content.airlinelogos.com/airlines/ba.png"},
  {id:"f4", from:"Cape Town", to:"New York", airline:"Emirates", stops:1, departure:"20:00", arrival:"06:00+1", duration:"15h", price:845, logo:"https://content.airlinelogos.com/airlines/emirates.png"},
  {id:"f5", from:"Cape Town", to:"Dubai", airline:"Emirates", stops:0, departure:"16:00", arrival:"00:00+1", duration:"8h", price:503, logo:"https://content.airlinelogos.com/airlines/emirates.png"}
];

// Render flights
function displayFlights(data){
  const container = document.querySelector(".flights-results");
  container.innerHTML = "";
  if(data.length===0){ container.innerHTML="<p>No flights found.</p>"; return; }
  data.forEach(f=>{
    const card = document.createElement("div");
    card.className="flight-card";
    card.innerHTML = `
      <div class="flight-header">
        <img src="${f.logo}" alt="${f.airline}" class="airline-logo">
        <div>
          <strong>${f.airline}</strong><br>
          ${f.departure} â†’ ${f.arrival} | ${f.duration} | ${f.stops} stops
        </div>
        <div>
          <strong>ZAR ${f.price}</strong><br>
          <button class="select-flight" data-id="${f.id}">Select</button>
        </div>
      </div>
    `;
    container.appendChild(card);
  });
}

// Initial display
displayFlights(flightData);

// Filters
document.querySelectorAll(".stops-filter, .airline-filter").forEach(input=>{
  input.addEventListener("change",()=>{
    let filtered = flightData.slice();
    const stopsChecked = Array.from(document.querySelectorAll(".stops-filter:checked")).map(i=>parseInt(i.value));
    if(stopsChecked.length>0){ filtered = filtered.filter(f=>stopsChecked.includes(f.stops)); }
    const airlineChecked = Array.from(document.querySelectorAll(".airline-filter:checked")).map(i=>i.value);
    if(airlineChecked.length>0){ filtered = filtered.filter(f=>airlineChecked.includes(f.airline)); }
    displayFlights(filtered);
  });
});

// Sort
document.getElementById("sort").addEventListener("change", e=>{
  let sorted = flightData.slice();
  if(e.target.value==="price") sorted.sort((a,b)=>a.price-b.price);
  if(e.target.value==="duration") sorted.sort((a,b)=>parseInt(a.duration)-parseInt(b.duration));
  if(e.target.value==="departure") sorted.sort((a,b)=>a.departure.localeCompare(b.departure));
  displayFlights(sorted);
});

// Search form
document.getElementById("flight-search").addEventListener("submit", e=>{
  e.preventDefault();
  const from = document.getElementById("from").value.toLowerCase();
  const to = document.getElementById("to").value.toLowerCase();
  const filtered = flightData.filter(f=>f.from.toLowerCase().includes(from) && f.to.toLowerCase().includes(to));
  displayFlights(filtered);
});

// Flight selection
document.addEventListener("click", e=>{
  if(e.target.classList.contains("select-flight")){
    const fid = e.target.dataset.id;
    const flight = flightData.find(f=>f.id===fid);
    localStorage.setItem("selectedFlight", JSON.stringify(flight));
    window.location.href="select-seat.html";
  }
});
